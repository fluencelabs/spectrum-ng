apiVersion: piraeus.io/v1
kind: LinstorCluster
metadata:
  name: linstor-cluster
spec:
  nodeSelector:
    beam/linstor_ready: "true"

  controller:
    enabled: true

  csiController:
    enabled: true

  csiNode:
    enabled: true

  nfsServer:
    enabled: false
  
  highAvailabilityController:
    enabled: false
---
apiVersion: piraeus.io/v1
kind: LinstorSatelliteConfiguration
metadata:
  name: talos-override
spec:
  podTemplate:
    metadata:
      annotations:
        k8s.v1.cni.cncf.io/networks: storage/linstor
        workload.default.ovn.kubernetes.io/logical_switch: linstor
    spec:
      initContainers:
        - name: drbd-shutdown-guard
          $patch: delete
        - name: drbd-module-loader
          $patch: delete
      containers:
        - name: linstor-satellite
          securityContext:
            privileged: true
          env:
            - name: NODE_NAME
              valueFrom:
                fieldRef:
                  fieldPath: spec.nodeName
            - name: LS_CONTROLLERS
              value: http://linstor-controller:3370
      volumes:
      - name: shared-data
        emptyDir: {}
      - name: run-systemd-system
        $patch: delete
      - name: run-drbd-shutdown-guard
        $patch: delete
      - name: systemd-bus-socket
        $patch: delete
      - name: lib-modules
        $patch: delete
      - name: usr-src
        $patch: delete
      - name: etc-lvm-backup
        hostPath:
          path: /var/etc/lvm/backup
          type: DirectoryOrCreate
      - name: etc-lvm-archive
        hostPath:
          path: /var/etc/lvm/archive
          type: DirectoryOrCreate
